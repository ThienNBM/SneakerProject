@model List<SneakerOutside2.Models.CartItem>

@{
    ViewData["Title"] = "Index";
}

<section id="blog-home" class="container">
    @if (Model.Count > 0)
    {
        <h2 class="font-weight-bold pt-5">Giỏ hàng</h2>
        int total = 0;
        <table class="table">
            <thead>
                <tr>
                    <th>
                        Xóa
                    </th>
                    <th>
                        Ảnh
                    </th>
                    <th>
                        Tên sản phẩm
                    </th>
                    <th>
                        Size
                    </th>
                    <th>
                        Đơn giá
                    </th>
                    <th>
                        Số lượng
                    </th>
                    <th>
                        Thành tiền
                    </th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    var thanhtien = item.AmountBuy * item.Price;
                    total += thanhtien;
                    <tr>
                        <td style="display:none">
                            @item.ProductItemID
                        </td>
                        <td style="display:none">
                            @Html.DisplayFor(modelItem => item.AmountStock)
                        </td>
                        <td>
                            <a asp-action="RemoveCart" asp-route-productItemId="@item.ProductItemID" class="btn btn-danger">
                                <i class="fas fa-trash-alt"></i>
                            </a>
                        </td>
                        <td>
                            <img width="200" src="@("https://localhost:44344/Images/" + item.Image)" asp-append-version="true">
                        </td>
                        <td>
                            @item.ProductName
                        </td>
                        <td>
                            @item.SizeName
                        </td>
                        <td>
                            @item.Price.ToString("n0")
                        </td>
                        <td>
                            <input class="w-25 pl-1" type="number" asp-for="@item.AmountBuy" id="@($"amountBuy-{item.ProductItemID}")" />
                        </td>
                        <td>
                            @(thanhtien.ToString("n0"))
                        </td>
                        <td>
                            <button class="btn btn-success updatecartitem" data-productItemId="@item.ProductItemID">
                                Cập nhật
                            </button>
                        </td>
                    </tr>
                }
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="6" class="text-right">Tổng tiền</td>
                    <td>@(total.ToString("n0"))</td>
                    <td>
                        <a asp-controller="CheckOut" asp-action="Index" class="btn btn-success">Thanh toán</a>
                    </td>
                </tr>
            </tfoot>
        </table>
    }
    else
    {
        <p class="alert alert-danger">Giỏ hàng trống</p>
    }
</section>

@section Scripts {
    <script type="text/javascript">
        $(document).ready(function () {
            $(".updatecartitem").click(function (event) {
                event.preventDefault();
                var productItemId = $(this).attr("data-productItemId");
                var amountBuy = $("#amountBuy-" + productItemId).val();
                $.ajax({
                    type: "POST",
                    url:"/Cart/UpdateCart",
                    data: {
                        productItemId: productItemId,
                        amountBuy: amountBuy
                    },
                    success: function (result) {
                        window.location.href = "@Url.Action("Index", "Cart")";
                    }
                });
            });
        });
    </script>
}
